<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Î‘Î½Î¬Î»Ï…ÏƒÎ·Ï‚ Î Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï… - Î‘' Î›Ï…ÎºÎµÎ¯Î¿Ï…</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 16px;
            line-height: 1.6;
        }
        
        .container { max-width: 900px; margin: 0 auto; }
        
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .header h1 { font-size: 1.5rem; color: #1e293b; }
        .header-subtitle { color: #64748b; font-size: 0.875rem; }
        
        .question-counter { text-align: right; }
        .question-counter span {
            font-size: 1.75rem;
            font-weight: 700;
            color: #4f46e5;
        }
        
        .progress-bar {
            background: #e2e8f0;
            border-radius: 999px;
            height: 8px;
            margin-top: 16px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: #4f46e5;
            height: 100%;
            transition: width 0.3s ease;
        }
        
        /* ÎŸÎ¸ÏŒÎ½Î· Î•Ï€Î¹Î»Î¿Î³ÏÎ½ */
        .selection-screen { text-align: center; }
        .selection-screen h2 {
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 1.75rem;
        }
        .selection-screen p {
            color: #64748b;
            margin-bottom: 24px;
        }
        
        .filter-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .filter-section h3 {
            color: #374151;
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .filter-btn:hover { border-color: #94a3b8; }
        
        .filter-btn.selected {
            border-color: #4f46e5;
            background: #4f46e5;
            color: white;
            font-weight: 600;
        }
        
        .start-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: #4f46e5;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .start-btn:hover { background: #3730a3; }
        .start-btn:disabled {
            background: #e2e8f0;
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        .count-info {
            background: #ecfdf5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            font-weight: 500;
        }
        
        .count-info.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        /* Loading */
        .loading { text-align: center; padding: 60px 20px; }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Quiz */
        .paragraph-label {
            display: inline-block;
            background: #e0e7ff;
            color: #3730a3;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .syndyasmos-badge {
            display: inline-block;
            background: #fef3c7;
            color: #92400e;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .paragraph-text {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #1e293b;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            border-radius: 12px;
            text-align: justify;
            line-height: 1.9;
            font-size: 1rem;
            border-left: 4px solid #4f46e5;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            /* Î‘Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎ· ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚/Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®Ï‚ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .question-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 20px;
            border: 2px solid transparent;
        }
        
        .question-card.correct { background: #dcfce7; border-color: #22c55e; }
        .question-card.incorrect { background: #fee2e2; border-color: #ef4444; }
        .question-card.partial { background: #fef9c3; border-color: #eab308; }
        
        .question-card h3 {
            color: #374151;
            font-size: 1rem;
            margin-bottom: 12px;
        }
        
        .multi-select-hint {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .option-btn {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            position: relative;
        }
        
        .option-btn:hover:not(:disabled) { border-color: #94a3b8; }
        .option-btn.selected { border-color: #4f46e5; background: #eef2ff; }
        .option-btn.correct-answer { 
            border-color: #047857; 
            background: #059669; 
            color: white;
            font-weight: 600;
            animation: glow 1.5s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 5px #059669, 0 0 10px #059669, 0 0 15px #059669;
            }
            50% { 
                box-shadow: 0 0 10px #10b981, 0 0 20px #10b981, 0 0 30px #10b981, 0 0 40px #10b981;
            }
        }
        .option-btn.correct-answer.was-selected::after {
            content: 'âœ“';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #047857;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .option-btn.wrong-answer { 
            border-color: #b91c1c; 
            background: #dc2626; 
            color: white;
            font-weight: 600;
        }
        .option-btn.wrong-answer::after {
            content: 'âœ—';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #b91c1c;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .option-btn:disabled { cursor: default; }
        .option-hint { font-size: 0.75rem; color: #64748b; margin-left: 8px; }
        .option-btn.correct-answer .option-hint,
        .option-btn.wrong-answer .option-hint { color: rgba(255,255,255,0.8); }
        
        .tropos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .tropos-btn {
            padding: 10px 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            position: relative;
        }
        
        .tropos-btn:hover:not(:disabled) { border-color: #94a3b8; }
        .tropos-btn.selected { border-color: #7c3aed; background: #f3e8ff; }
        .tropos-btn.selected-primary { border-color: #7c3aed; background: #ddd6fe; }
        .tropos-btn.correct-answer { 
            border-color: #047857; 
            background: #059669; 
            color: white;
            font-weight: 600;
            animation: glow 1.5s ease-in-out infinite;
        }
        .tropos-btn.correct-answer.was-selected::after {
            content: 'âœ“';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #047857;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tropos-btn.correct-primary { 
            border-color: #047857; 
            background: #059669; 
            color: white;
            font-weight: 600;
            animation: glow 1.5s ease-in-out infinite;
        }
        .tropos-btn.correct-primary.was-selected::after {
            content: 'âœ“';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #047857;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tropos-btn.wrong-answer {
            border-color: #b91c1c;
            background: #dc2626;
            color: white;
            font-weight: 600;
        }
        .tropos-btn.wrong-answer::after {
            content: 'âœ—';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #b91c1c;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .selection-order {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #7c3aed;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .main-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .main-btn.primary { background: #4f46e5; color: white; }
        .main-btn.primary:hover { background: #3730a3; }
        .main-btn.success { background: #16a34a; color: white; }
        .main-btn.success:hover { background: #15803d; }
        .main-btn:disabled { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }
        
        .feedback-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 20px;
        }
        
        .feedback-section h3 {
            color: #1e293b;
            font-size: 1.2rem;
            margin-bottom: 16px;
        }
        
        .feedback-box {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .feedback-box.blue { background: #eff6ff; }
        .feedback-box.purple { background: #faf5ff; }
        .feedback-box.green { background: #ecfdf5; }
        .feedback-box.amber { background: #fffbeb; }
        
        .feedback-box h4 { font-size: 0.95rem; margin-bottom: 8px; }
        .feedback-box.blue h4 { color: #1e40af; }
        .feedback-box.purple h4 { color: #6b21a8; }
        .feedback-box.green h4 { color: #065f46; }
        .feedback-box.amber h4 { color: #92400e; }
        
        .feedback-box p { font-size: 0.875rem; color: #374151; margin-bottom: 6px; }
        
        .tropos-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 6px;
        }
        
        .tropos-tag.primary { background: #ddd6fe; color: #5b21b6; }
        .tropos-tag.secondary { background: #e0e7ff; color: #3730a3; }
        
        /* Results */
        .results-card { text-align: center; padding: 40px 24px; }
        .results-emoji { font-size: 4rem; margin-bottom: 16px; }
        .results-title { font-size: 1.75rem; color: #1e293b; margin-bottom: 24px; }
        
        .results-score-box {
            background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .results-score { font-size: 3rem; font-weight: 700; color: #4f46e5; }
        .results-percentage { color: #64748b; font-size: 1.1rem; }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .detail-box { padding: 16px; border-radius: 12px; }
        .detail-box.blue { background: #eff6ff; }
        .detail-box.purple { background: #faf5ff; }
        .detail-box.green { background: #ecfdf5; }
        
        .detail-box p:first-child { font-size: 0.8rem; font-weight: 500; }
        .detail-box.blue p:first-child { color: #2563eb; }
        .detail-box.purple p:first-child { color: #7c3aed; }
        .detail-box.green p:first-child { color: #059669; }
        
        .detail-box p:last-child { font-size: 1.5rem; font-weight: 700; }
        .detail-box.blue p:last-child { color: #1d4ed8; }
        .detail-box.purple p:last-child { color: #6b21a8; }
        .detail-box.green p:last-child { color: #047857; }
        
        .theory-toggle {
            background: none;
            border: none;
            color: #4f46e5;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            padding: 8px 0;
        }
        
        .theory-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            font-size: 0.875rem;
        }
        
        .theory-box h3 { color: #92400e; margin-bottom: 12px; }
        .theory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        .theory-box ul { margin-left: 20px; color: #78350f; }
        .theory-box li { margin-bottom: 4px; font-size: 0.8rem; }
        
        @media (max-width: 600px) {
            .header { flex-direction: column; align-items: flex-start; }
            .tropos-grid { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: 1fr; }
            .filter-options { flex-direction: column; }
            .filter-btn { width: 100%; text-align: center; }
        }
        
        /* Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· */
        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .print-container {
                max-width: 100%;
                padding: 20px;
            }
            .print-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #333;
                padding-bottom: 15px;
            }
            .print-header h1 { font-size: 18pt; margin-bottom: 5px; }
            .print-header p { font-size: 11pt; color: #666; }
            .print-paragraph {
                margin-bottom: 25px;
                page-break-inside: avoid;
            }
            .print-paragraph-number {
                font-weight: bold;
                font-size: 12pt;
                margin-bottom: 8px;
            }
            .print-paragraph-text {
                font-size: 11pt;
                line-height: 1.8;
                text-align: justify;
                border: 1px solid #ccc;
                padding: 15px;
                background: #fafafa;
            }
            .print-answer-section {
                margin-top: 10px;
                border: 1px dashed #ccc;
                padding: 10px;
                min-height: 60px;
            }
            .print-answer-section p {
                font-size: 10pt;
                color: #666;
                margin-bottom: 5px;
            }
        }
        
        .print-only { display: none; }
        
        .print-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }
        .print-btn:hover { background: #047857; }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div class="card loading">
            <div class="loading-spinner"></div>
            <p>Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</p>
        </div>
    </div>

    <script>
        // =====================================================
        // Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£
        // =====================================================
        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTH8nczzu7hQKzQrz4ndfbiFsryk-5XUZ9Wn8tx6mOuW3FBXNyD2U0CCS22sh6Pj0pkRfFNk4rLjDnK/pub?output=csv';
        
        const tropoiAnaptyxis = [
            "Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±",
            "Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·", 
            "Î‘Î¯Ï„Î¹Î¿-Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±",
            "Î”Î¹Î±Î¯ÏÎµÏƒÎ·",
            "Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·-Î±Î½Ï„Î¯Î¸ÎµÏƒÎ·",
            "Î‘Î½Î±Î»Î¿Î³Î¯Î±",
            "ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚"
        ];

        let allData = []; // ÎŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
        let quizData = []; // Î¦Î¹Î»Ï„ÏÎ±ÏÎ¹ÏƒÎ¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
        
        let state = {
            screen: 'loading', // loading, selection, quiz, results
            // Î¦Î¯Î»Ï„ÏÎ±
            selectedDomiFilter: 'all', // all, Î”Î¹Î¼ÎµÏÎ®Ï‚, Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚
            selectedTroposFilter: 'all', // all, Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·, ÎºÎ»Ï€, syndyasmos
            selectedCount: 10, // 1, 10, 20
            selectedDifficulty: 'all', // all, 1, 2, 3
            // Quiz
            currentQuestion: 0,
            selectedDomi: null,
            selectedTropoi: [],
            showResult: false,
            score: { domi: 0, tropiKyrios: 0, tropiDeytereyon: 0 },
            showTheory: false
        };

        // =====================================================
        // DATA LOADING
        // =====================================================
        
        function parseCSVLine(line, delimiter) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === delimiter && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result.map(val => val.replace(/^"|"$/g, '').replace(/""/g, '"'));
        }
        
        function detectDelimiter(firstLine) {
            const commas = (firstLine.match(/,/g) || []).length;
            const semicolons = (firstLine.match(/;/g) || []).length;
            return semicolons > commas ? ';' : ',';
        }
        
        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            if (lines.length < 2) return [];
            
            const delimiter = detectDelimiter(lines[0]);
            const headers = parseCSVLine(lines[0], delimiter);
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i], delimiter);
                if (values.length >= 3) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        let value = values[index] || '';
                        value = value.trim();
                        if (value === '' || value.toLowerCase() === 'null') {
                            value = null;
                        }
                        obj[header.trim().toLowerCase()] = value;
                    });
                    
                    if (obj.keimeno && obj.domi && obj.kyrios) {
                        data.push(obj);
                    }
                }
            }
            return data;
        }

        async function loadData() {
            const proxies = [
                (u) => 'https://corsproxy.io/?' + encodeURIComponent(u),
                (u) => 'https://api.allorigins.win/raw?url=' + encodeURIComponent(u),
                (u) => u
            ];
            
            for (const getProxyUrl of proxies) {
                try {
                    const fetchUrl = getProxyUrl(GOOGLE_SHEET_CSV_URL);
                    const response = await fetch(fetchUrl);
                    
                    if (!response.ok) continue;
                    
                    const csv = await response.text();
                    if (!csv || csv.trim().startsWith('<!') || csv.trim().startsWith('<html')) continue;
                    
                    allData = parseCSV(csv);
                    if (allData.length > 0) {
                        state.screen = 'selection';
                        render();
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }
            
            // Fallback Î±Î½ Î±Ï€Î¿Ï„ÏÏ‡Î¿Ï…Î½ ÏŒÎ»Î±
            state.screen = 'selection';
            render();
        }
        
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // =====================================================
        // FILTERING
        // =====================================================
        
        function getFilteredData() {
            let filtered = [...allData];
            
            // Î¦Î¯Î»Ï„ÏÎ¿ Î´Î¿Î¼Î®Ï‚
            if (state.selectedDomiFilter !== 'all') {
                filtered = filtered.filter(item => item.domi === state.selectedDomiFilter);
            }
            
            // Î¦Î¯Î»Ï„ÏÎ¿ Ï„ÏÏŒÏ€Î¿Ï…
            if (state.selectedTroposFilter === 'syndyasmos') {
                filtered = filtered.filter(item => item.deytereyon !== null);
            } else if (state.selectedTroposFilter !== 'all') {
                filtered = filtered.filter(item => item.kyrios === state.selectedTroposFilter);
            }
            
            // Î¦Î¯Î»Ï„ÏÎ¿ Î´Ï…ÏƒÎºÎ¿Î»Î¯Î±Ï‚
            if (state.selectedDifficulty !== 'all') {
                filtered = filtered.filter(item => item.dyskoleia === state.selectedDifficulty);
            }
            
            return filtered;
        }
        
        function hasSyndyasmos(question) {
            return question.deytereyon !== null;
        }

        // =====================================================
        // RENDERING
        // =====================================================
        
        function render() {
            const app = document.getElementById('app');
            
            switch (state.screen) {
                case 'loading':
                    app.innerHTML = renderLoading();
                    break;
                case 'selection':
                    app.innerHTML = renderSelection();
                    break;
                case 'quiz':
                    app.innerHTML = renderQuiz();
                    break;
                case 'results':
                    app.innerHTML = renderResults();
                    break;
            }
            
            attachEventListeners();
        }
        
        function renderLoading() {
            return `
                <div class="card loading">
                    <div class="loading-spinner"></div>
                    <p>Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</p>
                </div>
            `;
        }
        
        function renderSelection() {
            const filteredCount = getFilteredData().length;
            
            return `
                <div class="card selection-screen">
                    <h2>ğŸ“ Quiz Î‘Î½Î¬Î»Ï…ÏƒÎ·Ï‚ Î Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï…</h2>
                    <p>ÎÎµÎ¿ÎµÎ»Î»Î·Î½Î¹ÎºÎ® Î“Î»ÏÏƒÏƒÎ± - Î›ÏÎºÎµÎ¹Î¿</p>
                    
                    <div class="filter-section">
                        <h3>ğŸ“ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î”Î¿Î¼Î®</h3>
                        <div class="filter-options">
                            <button class="filter-btn ${state.selectedDomiFilter === 'all' ? 'selected' : ''}" data-domi-filter="all">ÎŒÎ»ÎµÏ‚</button>
                            <button class="filter-btn ${state.selectedDomiFilter === 'Î”Î¹Î¼ÎµÏÎ®Ï‚' ? 'selected' : ''}" data-domi-filter="Î”Î¹Î¼ÎµÏÎ®Ï‚">Î”Î¹Î¼ÎµÏÎ®Ï‚</button>
                            <button class="filter-btn ${state.selectedDomiFilter === 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' ? 'selected' : ''}" data-domi-filter="Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚">Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h3>ğŸ“š Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¤ÏÏŒÏ€Î¿ Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚</h3>
                        <div class="filter-options">
                            <button class="filter-btn ${state.selectedTroposFilter === 'all' ? 'selected' : ''}" data-tropos-filter="all">ÎŒÎ»Î¿Î¹</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·' ? 'selected' : ''}" data-tropos-filter="Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·">Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î‘Î¯Ï„Î¹Î¿-Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±' ? 'selected' : ''}" data-tropos-filter="Î‘Î¯Ï„Î¹Î¿-Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±">Î‘Î¯Ï„Î¹Î¿-Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î”Î¹Î±Î¯ÏÎµÏƒÎ·' ? 'selected' : ''}" data-tropos-filter="Î”Î¹Î±Î¯ÏÎµÏƒÎ·">Î”Î¹Î±Î¯ÏÎµÏƒÎ·</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±' ? 'selected' : ''}" data-tropos-filter="Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±">Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·-Î±Î½Ï„Î¯Î¸ÎµÏƒÎ·' ? 'selected' : ''}" data-tropos-filter="Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·-Î±Î½Ï„Î¯Î¸ÎµÏƒÎ·">Î£ÏÎ³ÎºÏÎ¹ÏƒÎ·-Î±Î½Ï„Î¯Î¸ÎµÏƒÎ·</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'Î‘Î½Î±Î»Î¿Î³Î¯Î±' ? 'selected' : ''}" data-tropos-filter="Î‘Î½Î±Î»Î¿Î³Î¯Î±">Î‘Î½Î±Î»Î¿Î³Î¯Î±</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚' ? 'selected' : ''}" data-tropos-filter="ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚">ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
                            <button class="filter-btn ${state.selectedTroposFilter === 'syndyasmos' ? 'selected' : ''}" data-tropos-filter="syndyasmos">Î£Ï…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h3>ğŸ”¢ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î Î±ÏÎ±Î³ÏÎ¬Ï†Ï‰Î½</h3>
                        <div class="filter-options">
                            <button class="filter-btn ${state.selectedCount === 1 ? 'selected' : ''}" data-count="1">1</button>
                            <button class="filter-btn ${state.selectedCount === 10 ? 'selected' : ''}" data-count="10">10</button>
                            <button class="filter-btn ${state.selectedCount === 20 ? 'selected' : ''}" data-count="20">20</button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <h3>âš¡ Î’Î±Î¸Î¼ÏŒÏ‚ Î”Ï…ÏƒÎºÎ¿Î»Î¯Î±Ï‚</h3>
                        <div class="filter-options">
                            <button class="filter-btn ${state.selectedDifficulty === 'all' ? 'selected' : ''}" data-difficulty="all">ÎŒÎ»Î¿Î¹</button>
                            <button class="filter-btn ${state.selectedDifficulty === '1' ? 'selected' : ''}" data-difficulty="1">Î•Ï€Î¯Ï€ÎµÎ´Î¿ 1</button>
                            <button class="filter-btn ${state.selectedDifficulty === '2' ? 'selected' : ''}" data-difficulty="2">Î•Ï€Î¯Ï€ÎµÎ´Î¿ 2</button>
                            <button class="filter-btn ${state.selectedDifficulty === '3' ? 'selected' : ''}" data-difficulty="3">Î•Ï€Î¯Ï€ÎµÎ´Î¿ 3</button>
                        </div>
                    </div>
                    
                    <div class="count-info ${filteredCount === 0 ? 'warning' : ''}">
                        ${filteredCount > 0 
                            ? `âœ… Î’ÏÎ­Î¸Î·ÎºÎ±Î½ <strong>${filteredCount}</strong> Ï€Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Î¹ ${filteredCount < state.selectedCount ? `(Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ ÏŒÎ»ÎµÏ‚)` : `(Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ ${state.selectedCount})`}` 
                            : 'âš ï¸ Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï€Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Î¹ Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± ÎºÏÎ¹Ï„Î®ÏÎ¹Î±'}
                    </div>
                    
                    <button class="start-btn" id="startBtn" ${filteredCount === 0 ? 'disabled' : ''}>
                        ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î¿ Quiz
                    </button>
                    
                    <button class="print-btn" id="printBtn" ${filteredCount === 0 ? 'disabled' : ''}>
                        ğŸ–¨ï¸ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ· Î†ÏƒÎºÎ·ÏƒÎ·Ï‚ (Î¦ÏÎ»Î»Î¿ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚)
                    </button>
                </div>
            `;
        }
        
        function renderQuiz() {
            const current = quizData[state.currentQuestion];
            const progress = ((state.currentQuestion + 1) / quizData.length) * 100;
            const isSyndyasmos = hasSyndyasmos(current);
            
            return `
                <div class="card">
                    <div class="header">
                        <div>
                            <h1>ğŸ“ Î‘Î½Î¬Î»Ï…ÏƒÎ· Î Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï…</h1>
                            <p class="header-subtitle">ÎÎµÎ¿ÎµÎ»Î»Î·Î½Î¹ÎºÎ® Î“Î»ÏÏƒÏƒÎ± - Î›ÏÎºÎµÎ¹Î¿</p>
                        </div>
                        <div class="question-counter">
                            <p style="color: #64748b; font-size: 0.875rem;">Î•ÏÏÏ„Î·ÏƒÎ·</p>
                            <span>${state.currentQuestion + 1}/${quizData.length}</span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>

                <button class="theory-toggle" id="theoryToggle">
                    ${state.showTheory ? 'â–¼' : 'â–¶'} Î’Î¿Î®Î¸ÎµÎ¹Î±: Î˜ÎµÏ‰ÏÎ·Ï„Î¹ÎºÏŒ Î Î»Î±Î¯ÏƒÎ¹Î¿
                </button>

                ${state.showTheory ? `
                <div class="theory-box">
                    <h3>ğŸ“š Î¥Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ·</h3>
                    <div class="theory-grid">
                        <div>
                            <p style="font-weight: 600; margin-bottom: 8px; color: #92400e;">Î”Î¿Î¼Î® Î Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï…:</p>
                            <ul>
                                <li><strong>Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚:</strong> Î˜ÎµÎ¼Î±Ï„Î¹ÎºÎ® + Î£Ï‡ÏŒÎ»Î¹Î± + ÎšÎ±Ï„Î±ÎºÎ»ÎµÎ¯Î´Î±</li>
                                <li><strong>Î”Î¹Î¼ÎµÏÎ®Ï‚:</strong> Î˜ÎµÎ¼Î±Ï„Î¹ÎºÎ® + Î£Ï‡ÏŒÎ»Î¹Î± (Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Ï„Î±ÎºÎ»ÎµÎ¯Î´Î±)</li>
                            </ul>
                        </div>
                        <div>
                            <p style="font-weight: 600; margin-bottom: 8px; color: #92400e;">Î£Ï…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚ ÎœÎµÎ¸ÏŒÎ´Ï‰Î½:</p>
                            <ul>
                                <li>ÎœÎ¯Î± <strong>ÎºÏÏÎ¹Î±</strong> Î¼Î­Î¸Î¿Î´Î¿Ï‚ (Î²Î±ÏƒÎ¹ÎºÎ® Ï€ÏÏŒÎ¸ÎµÏƒÎ·)</li>
                                <li>ÎœÎ¯Î± Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ <strong>Î´ÎµÏ…Ï„ÎµÏÎµÏÎ¿Ï…ÏƒÎµÏ‚</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
                ` : ''}

                <div class="card">
                    <span class="paragraph-label">Î Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Ï‚ ${state.currentQuestion + 1}</span>
                    ${isSyndyasmos ? '<span class="syndyasmos-badge">âš¡ Î£Ï…Î½Î´Ï…Î±ÏƒÎ¼ÏŒÏ‚ Î¼ÎµÎ¸ÏŒÎ´Ï‰Î½</span>' : ''}
                    <p class="paragraph-text">${current.keimeno}</p>
                </div>

                <div class="questions-grid">
                    <div class="question-card ${state.showResult ? (state.selectedDomi === current.domi ? 'correct' : 'incorrect') : ''}">
                        <h3>1ï¸âƒ£ Î Î¿Î¹Î± ÎµÎ¯Î½Î±Î¹ Î· Î´Î¿Î¼Î® Ï„Î·Ï‚ Ï€Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï…;</h3>
                        <div class="options-list">
                            <button class="option-btn ${state.selectedDomi === 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' ? 'selected' : ''} ${state.showResult && 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' === current.domi ? 'correct-answer' : ''} ${state.showResult && state.selectedDomi === 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' && 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' === current.domi ? 'was-selected' : ''} ${state.showResult && state.selectedDomi === 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' && 'Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚' !== current.domi ? 'wrong-answer' : ''}" 
                                    data-domi="Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚" ${state.showResult ? 'disabled' : ''}>
                                Î¤ÏÎ¹Î¼ÎµÏÎ®Ï‚ <span class="option-hint">(Î¼Îµ ÎºÎ±Ï„Î±ÎºÎ»ÎµÎ¯Î´Î±)</span>
                            </button>
                            <button class="option-btn ${state.selectedDomi === 'Î”Î¹Î¼ÎµÏÎ®Ï‚' ? 'selected' : ''} ${state.showResult && 'Î”Î¹Î¼ÎµÏÎ®Ï‚' === current.domi ? 'correct-answer' : ''} ${state.showResult && state.selectedDomi === 'Î”Î¹Î¼ÎµÏÎ®Ï‚' && 'Î”Î¹Î¼ÎµÏÎ®Ï‚' === current.domi ? 'was-selected' : ''} ${state.showResult && state.selectedDomi === 'Î”Î¹Î¼ÎµÏÎ®Ï‚' && 'Î”Î¹Î¼ÎµÏÎ®Ï‚' !== current.domi ? 'wrong-answer' : ''}" 
                                    data-domi="Î”Î¹Î¼ÎµÏÎ®Ï‚" ${state.showResult ? 'disabled' : ''}>
                                Î”Î¹Î¼ÎµÏÎ®Ï‚ <span class="option-hint">(Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Ï„Î±ÎºÎ»ÎµÎ¯Î´Î±)</span>
                            </button>
                        </div>
                    </div>

                    <div class="question-card ${state.showResult ? getTroposResultClass(current) : ''}">
                        <h3>2ï¸âƒ£ Î Î¿Î¹Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿ Ï„ÏÏŒÏ€Î¿Ï‚ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚;</h3>
                        <p class="multi-select-hint">
                            ğŸ’¡ Î•Ï€Î¯Î»ÎµÎ¾Îµ Î¼Îµ Ï„Î· ÏƒÎµÎ¹ÏÎ¬: 1Î¿Ï‚ = ÎºÏÏÎ¹Î¿Ï‚, 2Î¿Ï‚ = Î´ÎµÏ…Ï„ÎµÏÎµÏÏ‰Î½ (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹)
                        </p>
                        <div class="tropos-grid">
                            ${tropoiAnaptyxis.map(tropos => {
                                const selIndex = state.selectedTropoi.indexOf(tropos);
                                const isSelected = selIndex !== -1;
                                const isPrimary = selIndex === 0;
                                const isCorrectKyrios = tropos === current.kyrios;
                                const isCorrectDeyt = tropos === current.deytereyon;
                                const isWrong = isSelected && !isCorrectKyrios && !isCorrectDeyt;
                                
                                let classes = 'tropos-btn';
                                if (isSelected && !state.showResult) classes += isPrimary ? ' selected-primary' : ' selected';
                                if (state.showResult) {
                                    if (isCorrectKyrios) classes += ' correct-primary';
                                    else if (isCorrectDeyt) classes += ' correct-answer';
                                    else if (isWrong) classes += ' wrong-answer';
                                    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· was-selected Î±Î½ ÎµÏ€Î¹Î»Î­Ï‡Î¸Î·ÎºÎµ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒ
                                    if (isSelected && (isCorrectKyrios || isCorrectDeyt)) classes += ' was-selected';
                                }
                                
                                return `
                                    <button class="${classes}" data-tropos="${tropos}" ${state.showResult ? 'disabled' : ''}>
                                        ${tropos}
                                        ${isSelected && !state.showResult ? `<span class="selection-order">${selIndex + 1}</span>` : ''}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>

                ${!state.showResult ? `
                    <button class="main-btn primary" id="checkBtn" ${!state.selectedDomi || state.selectedTropoi.length === 0 ? 'disabled' : ''}>
                        ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚
                    </button>
                ` : `
                    <div class="feedback-section">
                        <h3>ğŸ“‹ Î‘Î½Î¬Î»Ï…ÏƒÎ· Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚</h3>
                        
                        <div class="feedback-box blue">
                            <h4>${state.selectedDomi === current.domi ? 'âœ…' : 'âŒ'} Î”Î¿Î¼Î®: ${current.domi}</h4>
                            ${current.thematiki ? `<p><strong>Î˜ÎµÎ¼Î±Ï„Î¹ÎºÎ®:</strong> ${current.thematiki}</p>` : ''}
                            ${current.scholia ? `<p><strong>Î£Ï‡ÏŒÎ»Î¹Î±:</strong> ${current.scholia}</p>` : ''}
                            ${current.katakleida ? `<p><strong>ÎšÎ±Ï„Î±ÎºÎ»ÎµÎ¯Î´Î±:</strong> ${current.katakleida}</p>` : ''}
                        </div>

                        <div class="feedback-box purple">
                            <h4>Î¤ÏÏŒÏ€Î¿Ï‚/Î¿Î¹ Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚:</h4>
                            <p>
                                <span class="tropos-tag primary">ÎšÏÏÎ¹Î¿Ï‚: ${current.kyrios}</span>
                                ${current.deytereyon ? `<span class="tropos-tag secondary">Î”ÎµÏ…Ï„ÎµÏÎµÏÏ‰Î½: ${current.deytereyon}</span>` : ''}
                            </p>
                            ${current.aitiologisi ? `<p style="margin-top: 10px;">${current.aitiologisi}</p>` : ''}
                        </div>

                        <div class="feedback-box amber">
                            <h4>ğŸ“Š Î— ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÎ¿Ï…:</h4>
                            <p>
                                ${state.selectedTropoi.length > 0 ? `<span class="tropos-tag primary">1Î¿Ï‚: ${state.selectedTropoi[0]}</span>` : ''}
                                ${state.selectedTropoi.length > 1 ? `<span class="tropos-tag secondary">2Î¿Ï‚: ${state.selectedTropoi[1]}</span>` : ''}
                            </p>
                            <p style="margin-top: 8px;">
                                ÎšÏÏÎ¹Î¿Ï‚: ${state.selectedTropoi[0] === current.kyrios ? 'âœ… Î£Ï‰ÏƒÏ„Î¬' : 'âŒ Î›Î¬Î¸Î¿Ï‚'}
                                ${current.deytereyon ? ` | Î”ÎµÏ…Ï„ÎµÏÎµÏÏ‰Î½: ${state.selectedTropoi[1] === current.deytereyon ? 'âœ… Î£Ï‰ÏƒÏ„Î¬' : (state.selectedTropoi.length < 2 ? 'âš ï¸ Î”ÎµÎ½ ÎµÏ€Î¹Î»Î­Ï‡Î¸Î·ÎºÎµ' : 'âŒ Î›Î¬Î¸Î¿Ï‚')}` : ''}
                            </p>
                        </div>

                        ${current.prothesi ? `
                        <div class="feedback-box green">
                            <h4>ğŸ¯ Î ÏÏŒÎ¸ÎµÏƒÎ· Î£Ï…Î½Ï„Î¬ÎºÏ„Î·</h4>
                            <p>${current.prothesi}</p>
                        </div>
                        ` : ''}
                    </div>

                    <button class="main-btn success" id="nextBtn">
                        ${state.currentQuestion < quizData.length - 1 ? 'Î•Ï€ÏŒÎ¼ÎµÎ½Î· Î•ÏÏÏ„Î·ÏƒÎ· â†’' : 'Î”ÎµÏ‚ Ï„Î± Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±'}
                    </button>
                `}
            `;
        }

        function getTroposResultClass(current) {
            const kyriosCorrect = state.selectedTropoi[0] === current.kyrios;
            const deytereyonCorrect = !current.deytereyon || state.selectedTropoi[1] === current.deytereyon;
            
            if (kyriosCorrect && deytereyonCorrect) return 'correct';
            if (kyriosCorrect || (current.deytereyon && state.selectedTropoi.includes(current.deytereyon))) return 'partial';
            return 'incorrect';
        }

        function renderResults() {
            const maxDomi = quizData.length;
            const maxTropiKyrios = quizData.length;
            const maxTropiDeytereyon = quizData.filter(q => q.deytereyon).length;
            
            const totalMax = maxDomi + maxTropiKyrios + maxTropiDeytereyon;
            const totalScore = state.score.domi + state.score.tropiKyrios + state.score.tropiDeytereyon;
            const percentage = Math.round((totalScore / totalMax) * 100);
            const emoji = percentage >= 80 ? 'ğŸ‰' : percentage >= 60 ? 'ğŸ‘' : 'ğŸ“š';

            return `
                <div class="card results-card">
                    <div class="results-emoji">${emoji}</div>
                    <h2 class="results-title">ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµÏ‚ Ï„Î¿ Quiz!</h2>
                    
                    <div class="results-score-box">
                        <p class="results-score">${totalScore} / ${totalMax}</p>
                        <p class="results-percentage">(${percentage}%)</p>
                    </div>

                    <div class="results-grid">
                        <div class="detail-box blue">
                            <p>Î”Î¿Î¼Î®</p>
                            <p>${state.score.domi}/${maxDomi}</p>
                        </div>
                        <div class="detail-box purple">
                            <p>ÎšÏÏÎ¹Î¿Ï‚ Î¤ÏÏŒÏ€Î¿Ï‚</p>
                            <p>${state.score.tropiKyrios}/${maxTropiKyrios}</p>
                        </div>
                        <div class="detail-box green">
                            <p>Î”ÎµÏ…Ï„ÎµÏÎµÏÏ‰Î½</p>
                            <p>${state.score.tropiDeytereyon}/${maxTropiDeytereyon}</p>
                        </div>
                    </div>

                    <button class="main-btn primary" id="restartBtn" style="margin-bottom: 12px;">
                        ÎÎµÎºÎ¯Î½Î± ÎÎ±Î½Î¬
                    </button>
                    <button class="main-btn" id="newSelectionBtn" style="background: #64748b; color: white;">
                        ÎÎ­Î± Î•Ï€Î¹Î»Î¿Î³Î® ÎšÏÎ¹Ï„Î·ÏÎ¯Ï‰Î½
                    </button>
                </div>
            `;
        }

        // =====================================================
        // EVENT LISTENERS
        // =====================================================
        
        function attachEventListeners() {
            // Selection screen
            document.querySelectorAll('[data-domi-filter]').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedDomiFilter = btn.dataset.domiFilter;
                    render();
                });
            });
            
            document.querySelectorAll('[data-tropos-filter]').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedTroposFilter = btn.dataset.troposFilter;
                    render();
                });
            });
            
            document.querySelectorAll('[data-count]').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedCount = parseInt(btn.dataset.count);
                    render();
                });
            });
            
            document.querySelectorAll('[data-difficulty]').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedDifficulty = btn.dataset.difficulty;
                    render();
                });
            });
            
            const startBtn = document.getElementById('startBtn');
            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    let filtered = shuffleArray(getFilteredData());
                    // Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ„Î¿Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ
                    quizData = filtered.slice(0, state.selectedCount);
                    state.screen = 'quiz';
                    state.currentQuestion = 0;
                    state.selectedDomi = null;
                    state.selectedTropoi = [];
                    state.showResult = false;
                    state.score = { domi: 0, tropiKyrios: 0, tropiDeytereyon: 0 };
                    render();
                });
            }
            
            const printBtn = document.getElementById('printBtn');
            if (printBtn) {
                printBtn.addEventListener('click', () => {
                    let filtered = shuffleArray(getFilteredData());
                    const printData = filtered.slice(0, state.selectedCount);
                    printWorksheet(printData);
                });
            }
            
            // Quiz screen
            const theoryToggle = document.getElementById('theoryToggle');
            if (theoryToggle) {
                theoryToggle.addEventListener('click', () => {
                    state.showTheory = !state.showTheory;
                    render();
                });
            }

            document.querySelectorAll('[data-domi]').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedDomi = btn.dataset.domi;
                    render();
                });
            });

            document.querySelectorAll('[data-tropos]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tropos = btn.dataset.tropos;
                    const index = state.selectedTropoi.indexOf(tropos);
                    
                    if (index !== -1) {
                        state.selectedTropoi.splice(index, 1);
                    } else if (state.selectedTropoi.length < 2) {
                        state.selectedTropoi.push(tropos);
                    } else {
                        state.selectedTropoi[1] = tropos;
                    }
                    render();
                });
            });

            const checkBtn = document.getElementById('checkBtn');
            if (checkBtn) {
                checkBtn.addEventListener('click', () => {
                    const current = quizData[state.currentQuestion];
                    
                    if (state.selectedDomi === current.domi) state.score.domi += 1;
                    if (state.selectedTropoi[0] === current.kyrios) state.score.tropiKyrios += 1;
                    if (current.deytereyon && state.selectedTropoi[1] === current.deytereyon) state.score.tropiDeytereyon += 1;
                    
                    state.showResult = true;
                    render();
                });
            }

            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (state.currentQuestion < quizData.length - 1) {
                        state.currentQuestion += 1;
                        state.selectedDomi = null;
                        state.selectedTropoi = [];
                        state.showResult = false;
                    } else {
                        state.screen = 'results';
                    }
                    render();
                });
            }

            // Results screen
            const restartBtn = document.getElementById('restartBtn');
            if (restartBtn) {
                restartBtn.addEventListener('click', () => {
                    let filtered = shuffleArray(getFilteredData());
                    quizData = filtered.slice(0, state.selectedCount);
                    state.currentQuestion = 0;
                    state.selectedDomi = null;
                    state.selectedTropoi = [];
                    state.showResult = false;
                    state.score = { domi: 0, tropiKyrios: 0, tropiDeytereyon: 0 };
                    state.screen = 'quiz';
                    render();
                });
            }
            
            const newSelectionBtn = document.getElementById('newSelectionBtn');
            if (newSelectionBtn) {
                newSelectionBtn.addEventListener('click', () => {
                    state.screen = 'selection';
                    state.currentQuestion = 0;
                    state.selectedDomi = null;
                    state.selectedTropoi = [];
                    state.showResult = false;
                    state.score = { domi: 0, tropiKyrios: 0, tropiDeytereyon: 0 };
                    render();
                });
            }
        }

        // =====================================================
        // PRINT WORKSHEET
        // =====================================================
        
        function printWorksheet(data) {
            const printWindow = window.open('', '_blank');
            
            let paragraphsHTML = data.map((item, index) => `
                <div class="print-paragraph">
                    <div class="print-paragraph-number"><b>Î Î±ÏÎ¬Î³ÏÎ±Ï†Î¿Ï‚ ${index + 1}</b></div>
                    <div class="print-paragraph-text">${item.keimeno}</div>
                </div>
            `).join('');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="el">
                <head>
                    <meta charset="UTF-8">
                    <title>Î‘Î£ÎšÎ—Î£Î— - Î‘Î½Î¬Î»Ï…ÏƒÎ· Î Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï…</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body {
                            font-family: 'Times New Roman', serif;
                            padding: 40px;
                            line-height: 1.6;
                        }
                        .print-title {
                            text-align: center;
                            font-size: 18pt;
                            font-weight: bold;
                            margin-bottom: 20px;
                        }
                        .print-instructions {
                            font-size: 11pt;
                            text-align: justify;
                            margin-bottom: 30px;
                            line-height: 1.8;
                        }
                        .print-paragraph {
                            margin-bottom: 25px;
                            page-break-inside: avoid;
                        }
                        .print-paragraph-number {
                            font-size: 11pt;
                            margin-bottom: 8px;
                        }
                        .print-paragraph-text {
                            font-size: 11pt;
                            line-height: 1.8;
                            text-align: justify;
                        }
                        @media print {
                            body { padding: 20px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-title">Î‘Î£ÎšÎ—Î£Î—</div>
                    
                    <div class="print-instructions">
                        ÎÎ± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Ï„Î· Î´Î¿Î¼Î® ÎºÎ±Î¹ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Î® Ï„Î¿Ï…Ï‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Ï„Î·Ï‚ Ï€Î±ÏÎ±Î³ÏÎ¬Ï†Î¿Ï… ÎºÎ±Î¹ Î½Î± Ï„Î¿Ï…Ï‚ Î±Î¹Ï„Î¹Î¿Î»Î¿Î³Î®ÏƒÎµÏ„Îµ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î·Î½ Ï€ÏÏŒÎ¸ÎµÏƒÎ· Ï„Î¿Ï… ÏƒÏ…Î½Ï„Î¬ÎºÏ„Î·.
                    </div>
                    
                    ${paragraphsHTML}
                    
                    <button class="no-print" onclick="window.print()" style="
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        padding: 15px 30px;
                        font-size: 16px;
                        background: #4f46e5;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                    ">ğŸ–¨ï¸ Î•ÎºÏ„ÏÏ€Ï‰ÏƒÎ·</button>
                </body>
                </html>
            `);
            
            printWindow.document.close();
        }

        // =====================================================
        // INIT
        // =====================================================
        loadData();
        
        // Î‘Ï€Î±Î³ÏŒÏÎµÏ…ÏƒÎ· Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®Ï‚ ÏƒÏ„Î·Î½ Ï€Î±ÏÎ¬Î³ÏÎ±Ï†Î¿
        document.addEventListener('copy', function(e) {
            const selection = window.getSelection();
            const container = selection.anchorNode?.parentElement;
            if (container && container.closest('.paragraph-text')) {
                e.preventDefault();
            }
        });
        
        document.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.paragraph-text')) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
